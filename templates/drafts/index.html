{% extends 'base.html' %}
{% block title %}
{{ title }}
{% endblock %}
{% block drafts %} active {% endblock %}

{% block content %}
<style>
  :root {
    --color-background: #0B0C10;
    --color-text: #EDF5E1;
    --color-accent: #66FCF1;
    --color-accent-dark: #05386B;
    --color-link: #8EE4AF;
    --color-link-hover: #5CDB95;
  }

  body {
    background-color: var(--color-background);
    color: var(--color-text);
    font-family: 'Inter', 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif;
    margin: 0;
    padding: 0;
    overflow-x: hidden;
    background:
      radial-gradient(circle at 25% 25%, rgba(102, 252, 241, 0.03) 0%, transparent 50%),
      radial-gradient(circle at 75% 75%, rgba(142, 228, 175, 0.03) 0%, transparent 50%),
      var(--color-background);
  }

  .drafts-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 40px 20px;
    position: relative;
  }

  .drafts-container::after {
    content: '';
    position: absolute;
    top: 15%;
    right: 8%;
    width: 40px;
    height: 40px;
    background: linear-gradient(45deg, rgba(102, 252, 241, 0.08), rgba(142, 228, 175, 0.08));
    border-radius: 50%;
    animation: float-gentle 6s ease-in-out infinite;
    pointer-events: none;
  }

  @keyframes float-gentle {
    0%, 100% { transform: translateY(0px) rotate(0deg); }
    50% { transform: translateY(-15px) rotate(180deg); }
  }

  .page-header {
    text-align: center;
    padding: 60px 20px 80px;
    background: linear-gradient(135deg,
      rgba(11, 12, 16, 0.95) 0%,
      rgba(5, 56, 107, 0.18) 40%,
      rgba(142, 228, 175, 0.05) 60%,
      rgba(11, 12, 16, 0.95) 100%);
    border-radius: 0 0 40px 40px;
    margin-bottom: 50px;
    position: relative;
    overflow: hidden;
  }

  .page-header::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background:
      radial-gradient(circle at 30% 40%, rgba(102, 252, 241, 0.08) 0%, transparent 40%),
      radial-gradient(circle at 70% 60%, rgba(142, 228, 175, 0.06) 0%, transparent 40%);
    pointer-events: none;
    animation: gentle-pulse 8s ease-in-out infinite;
  }

  @keyframes gentle-pulse {
    0%, 100% { opacity: 0.3; }
    50% { opacity: 0.7; }
  }

  .page-header::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 50%;
    transform: translateX(-50%);
    width: 120px;
    height: 3px;
    background: linear-gradient(90deg,
      transparent,
      var(--color-accent),
      var(--color-link),
      transparent);
    border-radius: 2px;
    box-shadow: 0 0 15px rgba(102, 252, 241, 0.4);
  }

  .header-content {
    position: relative;
    z-index: 2;
    max-width: 800px;
    margin: 0 auto;
  }

  .drafts-title {
    font-size: clamp(2rem, 5vw, 3.2rem);
    font-weight: 800;
    color: var(--color-accent);
    margin-bottom: 20px;
    letter-spacing: -0.01em;
    text-shadow:
      0 0 30px rgba(102, 252, 241, 0.3),
      0 4px 12px rgba(0, 0, 0, 0.3);
    line-height: 1.1;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 20px;
  }

  .drafts-title span {
    font-size: 2.5rem;
    filter: drop-shadow(0 0 20px rgba(102, 252, 241, 0.4));
    transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  }

  .drafts-title:hover span {
    transform: scale(1.15) rotate(-5deg);
    filter: drop-shadow(0 0 25px rgba(102, 252, 241, 0.6));
  }

  .drafts-subtitle {
    font-size: 1.1rem;
    color: var(--color-text);
    opacity: 0.8;
  }

  .drafts-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
    gap: 25px;
    margin-bottom: 40px;
  }

  .draft-card {
    background: rgba(11, 12, 16, 0.8);
    border: 1px solid rgba(102, 252, 241, 0.2);
    border-radius: 25px;
    padding: 35px;
    backdrop-filter: blur(20px);
    box-shadow:
      0 25px 50px rgba(0, 0, 0, 0.3),
      0 0 0 1px rgba(102, 252, 241, 0.1),
      inset 0 1px 0 rgba(255, 255, 255, 0.05);
    position: relative;
    overflow: hidden;
    transition: all 0.3s ease;
  }

  .draft-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 2px;
    background: linear-gradient(90deg,
      transparent,
      rgba(102, 252, 241, 0.5),
      rgba(142, 228, 175, 0.5),
      transparent);
  }

  .draft-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 15px 40px rgba(102, 252, 241, 0.15);
    border-color: rgba(102, 252, 241, 0.4);
  }

  .draft-card:hover::before {
    opacity: 1;
  }

  .draft-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 20px;
  }

  .draft-title {
    font-size: 1.2rem;
    font-weight: 600;
    color: var(--color-accent);
    margin: 0;
    line-height: 1.3;
    flex: 1;
    margin-right: 15px;
  }

  .draft-method {
    background: linear-gradient(135deg,
      rgba(102, 252, 241, 0.1),
      rgba(142, 228, 175, 0.1));
    color: var(--color-accent);
    padding: 8px 16px;
    border-radius: 25px;
    font-size: 0.85rem;
    font-weight: 600;
    white-space: nowrap;
    border: 1px solid rgba(102, 252, 241, 0.3);
    backdrop-filter: blur(10px);
    box-shadow: 0 4px 15px rgba(102, 252, 241, 0.1);
  }

  /* –°—Ç–∏–ª–∏ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö —á–µ—Ä–Ω–æ–≤–∏–∫–æ–≤ - —Ç–æ–ª—å–∫–æ –∑–Ω–∞—á–æ–∫ */

  .auto-save-badge {
    display: inline-flex;
    align-items: center;
    gap: 5px;
    background: linear-gradient(135deg,
      rgba(255, 215, 0, 0.2),
      rgba(255, 193, 7, 0.15));
    color: #FF8C00;
    padding: 4px 10px;
    border-radius: 15px;
    font-size: 0.75rem;
    font-weight: 600;
    border: 1px solid rgba(255, 215, 0, 0.3);
  }



  .draft-info {
    margin-bottom: 25px;
  }

  .draft-route {
    color: var(--color-text);
    font-size: 0.9rem;
    margin-bottom: 10px;
    opacity: 0.8;
  }

  .draft-dates {
    display: flex;
    justify-content: space-between;
    font-size: 0.8rem;
    color: var(--color-text);
    opacity: 0.6;
  }

  .draft-actions {
    display: flex;
    gap: 15px;
    align-items: stretch;
    width: 100%;
  }

  .draft-actions button {
    flex: 1;
    min-width: 0;
    width: auto;
  }

  .btn-continue {
    background: var(--color-link);
    color: var(--color-background);
    border: 2px solid var(--color-link);
    padding: 15px 25px;
    border-radius: 16px;
    font-weight: 700;
    font-size: 1rem;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    text-transform: none;
    letter-spacing: 0.5px;
    white-space: nowrap;
    min-width: 0;
    flex: 1;
  }



  .btn-continue span,
  .btn-delete span {
    position: relative;
  }

  .btn-continue:hover {
    background: var(--color-link-hover);
    border-color: var(--color-link-hover);
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(142, 228, 175, 0.4);
  }

  .btn-delete {
    background: rgba(255, 107, 125, 0.1);
    color: #ffccd5;
    border: 2px solid rgba(255, 107, 125, 0.3);
    padding: 15px 25px;
    border-radius: 16px;
    font-weight: 700;
    font-size: 1rem;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    text-transform: none;
    letter-spacing: 0.5px;
    backdrop-filter: blur(10px);
    white-space: nowrap;
    min-width: 0;
  }

  .btn-delete:hover {
    background: rgba(255, 107, 125, 0.2);
    border-color: rgba(255, 107, 125, 0.5);
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(255, 107, 125, 0.2);
  }

  .empty-state {
    text-align: center;
    padding: 80px 20px;
    color: var(--color-text);
    opacity: 0.6;
  }

  .empty-icon {
    font-size: 4rem;
    margin-bottom: 20px;
    opacity: 0.3;
  }

  .empty-text {
    font-size: 1.2rem;
    margin-bottom: 10px;
  }

  .empty-subtext {
    font-size: 0.9rem;
    opacity: 0.7;
  }

  .loading {
    text-align: center;
    padding: 60px 20px;
    color: var(--color-accent);
  }

  .spinner {
    border: 3px solid rgba(102, 252, 241, 0.3);
    border-top: 3px solid var(--color-accent);
    border-radius: 50%;
    width: 40px;
    height: 40px;
    animation: spin 1s linear infinite;
    margin: 0 auto 20px;
  }

  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }

  @media (max-width: 768px) {
    .page-header {
      padding: 40px 20px 50px;
      border-radius: 0 0 25px 25px;
    }

    .drafts-title {
      display: block;
      text-align: center;
    }

    .drafts-title span {
      display: block;
      margin: 0 auto 15px;
      font-size: 2rem;
    }

    .drafts-grid {
      grid-template-columns: 1fr;
    }

    .draft-card {
      padding: 25px 20px;
    }

    .draft-header {
      flex-direction: column;
      gap: 15px;
    }

    .draft-actions {
      flex-direction: column;
      gap: 15px;
    }

    .btn-continue,
    .btn-delete {
      width: 100%;
    }

    .auto-save-badge {
      margin-left: 0;
      margin-top: 8px;
      align-self: flex-start;
    }
    }
  }

  @media (max-width: 480px) {
    .drafts-container {
      padding: 20px 15px;
    }

    .page-header {
      padding: 30px 15px 40px;
    }

    .draft-card {
      padding: 20px 15px;
    }
  }

  /* –°—Ç–∏–ª–∏ –¥–ª—è –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ */
  #pagination-controls {
    margin-top: 40px;
    padding: 30px;
    background: rgba(5, 56, 107, 0.1);
    border-radius: 20px;
    border: 1px solid rgba(102, 252, 241, 0.1);
  }

  .pagination-info {
    text-align: center;
    margin-bottom: 25px;
    color: var(--color-text);
    font-size: 14px;
    opacity: 0.8;
  }

  .pagination-controls {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 20px;
  }

  .per-page-selector {
    display: flex;
    align-items: center;
    gap: 10px;
    color: var(--color-text);
    font-size: 14px;
  }

  .per-page-selector select {
    background: rgba(11, 12, 16, 0.8);
    border: 1px solid rgba(102, 252, 241, 0.3);
    border-radius: 8px;
    color: var(--color-text);
    padding: 8px 12px;
    font-size: 14px;
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .per-page-selector select:hover {
    border-color: var(--color-accent);
    background: rgba(11, 12, 16, 0.9);
  }

  .per-page-selector select:focus {
    outline: none;
    border-color: var(--color-accent);
    box-shadow: 0 0 0 2px rgba(102, 252, 241, 0.2);
  }

  .pagination-buttons {
    display: flex;
    align-items: center;
    gap: 15px;
  }

  .pagination-btn {
    background: rgba(5, 56, 107, 0.6);
    border: 1px solid rgba(102, 252, 241, 0.3);
    border-radius: 10px;
    color: var(--color-text);
    padding: 10px 16px;
    font-size: 14px;
    cursor: pointer;
    transition: all 0.3s ease;
    min-width: 120px;
  }

  .pagination-btn:hover:not(:disabled) {
    background: rgba(5, 56, 107, 0.8);
    border-color: var(--color-accent);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(102, 252, 241, 0.2);
  }

  .pagination-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    background: rgba(11, 12, 16, 0.3);
    border-color: rgba(102, 252, 241, 0.1);
  }

  .page-numbers {
    display: flex;
    gap: 8px;
    align-items: center;
  }

  .page-number {
    background: rgba(11, 12, 16, 0.6);
    border: 1px solid rgba(102, 252, 241, 0.2);
    border-radius: 8px;
    color: var(--color-text);
    padding: 8px 12px;
    font-size: 14px;
    cursor: pointer;
    transition: all 0.3s ease;
    min-width: 40px;
    text-align: center;
  }

  .page-number:hover {
    background: rgba(5, 56, 107, 0.6);
    border-color: var(--color-accent);
    transform: translateY(-1px);
  }

  .page-number.active {
    background: var(--color-accent);
    color: var(--color-background);
    border-color: var(--color-accent);
    font-weight: 600;
  }

  .page-number.ellipsis {
    cursor: default;
    border: none;
    background: transparent;
    color: var(--color-text);
    opacity: 0.6;
  }

  .page-number.ellipsis:hover {
    background: transparent;
    transform: none;
  }

  /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ */
  @media (max-width: 768px) {
    #pagination-controls {
      padding: 20px 15px;
    }

    .pagination-controls {
      gap: 15px;
    }

    .pagination-buttons {
      flex-direction: column;
      gap: 15px;
    }

    .page-numbers {
      order: -1;
    }

    .pagination-btn {
      min-width: 100px;
      padding: 8px 12px;
      font-size: 13px;
    }
  }
</style>

<div class="drafts-container">
  <div class="page-header">
    <div class="header-content">
      <h1 class="drafts-title">
        <span style="margin-right: 20px;">üìù</span>
        –ú–æ—ó —á–µ—Ä–Ω–µ—Ç–∫–∏
      </h1>
      <p class="drafts-subtitle">
        –ó–±–µ—Ä–µ–∂–µ–Ω—ñ –ø—Ä–æ–≥—Ä–µ—Å —Ä–æ–±–æ—Ç–∏ –∑ –º–µ—Ç–æ–¥–∞–º–∏ –ø—Ä–∏–π–Ω—è—Ç—Ç—è —Ä—ñ—à–µ–Ω—å
      </p>
    </div>
  </div>

  <div id="drafts-content">
    <div class="loading">
      <div class="spinner"></div>
      <p>–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —á–µ—Ä–Ω–µ—Ç–æ–∫...</p>
    </div>
  </div>

  <!-- –≠–ª–µ–º–µ–Ω—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π -->
  <div id="pagination-controls" style="display: none;">
    <div class="pagination-info">
      <span id="pagination-text">–ü–æ–∫–∞–∑–∞–Ω–æ 0-0 –∑ 0 —á–µ—Ä–Ω–µ—Ç–æ–∫</span>
    </div>

    <div class="pagination-controls">
      <div class="per-page-selector">
        <label for="per-page">–ù–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ:</label>
        <select id="per-page" onchange="changePerPage()">
          <option value="5">5</option>
          <option value="10" selected>10</option>
          <option value="20">20</option>
          <option value="50">50</option>
        </select>
      </div>

      <div class="pagination-buttons">
        <button id="prev-page" class="pagination-btn" onclick="goToPage('prev')" disabled>
          ‚Üê –ü–æ–ø–µ—Ä–µ–¥–Ω—è
        </button>

        <div class="page-numbers" id="page-numbers">
          <!-- –ù–æ–º–µ—Ä–∞ —Å—Ç—Ä–∞–Ω–∏—Ü –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
        </div>

        <button id="next-page" class="pagination-btn" onclick="goToPage('next')" disabled>
          –ù–∞—Å—Ç—É–ø–Ω–∞ ‚Üí
        </button>
      </div>
    </div>
  </div>
</div>

<script>
// –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –ø–∞–≥–∏–Ω–∞—Ü–∏–∏
let currentPage = 1;
let currentPerPage = 10;
let totalPages = 1;
let totalItems = 0;

document.addEventListener('DOMContentLoaded', function() {
  // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ per-page –∏–∑ URL –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∏–ª–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
  const urlParams = new URLSearchParams(window.location.search);
  const pageParam = urlParams.get('page');
  const perPageParam = urlParams.get('per_page');

  if (pageParam) currentPage = parseInt(pageParam);
  if (perPageParam) currentPerPage = parseInt(perPageParam);

  // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –≤ —Å–µ–ª–µ–∫—Ç
  document.getElementById('per-page').value = currentPerPage;

  loadDrafts();
});

async function loadDrafts() {
  try {
    const response = await fetch(`/drafts/api?page=${currentPage}&per_page=${currentPerPage}`);
    if (!response.ok) {
      throw new Error('Failed to fetch drafts');
    }

    const data = await response.json();
    displayDrafts(data.drafts);

    // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏
    if (data.pagination) {
      updatePaginationInfo(data.pagination);
      displayPagination(data.pagination);
    }
  } catch (error) {
    console.error('Error loading drafts:', error);
    showError('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —á–µ—Ä–Ω–µ—Ç–æ–∫');
  }
}

function displayDrafts(drafts) {
  const container = document.getElementById('drafts-content');

  if (!drafts || drafts.length === 0) {
    container.innerHTML = `
      <div class="empty-state">
        <div class="empty-icon">üìù</div>
        <div class="empty-text">–£ –≤–∞—Å –ø–æ–∫–∏ –Ω–µ–º–∞—î —á–µ—Ä–Ω–µ—Ç–æ–∫</div>
        <div class="empty-subtext">
          –ü–æ—á–Ω—ñ—Ç—å —Ä–æ–±–æ—Ç—É –∑ –±—É–¥—å-—è–∫–∏–º –º–µ—Ç–æ–¥–æ–º —Ç–∞ –∑–±–µ—Ä–µ–∂—ñ—Ç—å –ø—Ä–æ–≥—Ä–µ—Å
        </div>
      </div>
    `;

    // –°–∫—Ä—ã–≤–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ –µ—Å–ª–∏ –Ω–µ—Ç —á–µ—Ä–Ω–æ–≤–∏–∫–æ–≤
    document.getElementById('pagination-controls').style.display = 'none';
    return;
  }

    const draftsHTML = drafts.map(draft => {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —á–µ—Ä–Ω–æ–≤–∏–∫ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–º
    const isAutoSave = draft.title && draft.title.startsWith('üîÑ');

    return `
    <div class="draft-card" data-draft-id="${draft.id}">
      <div class="draft-header">
        <h3 class="draft-title">${escapeHtml(draft.title)}</h3>
        <div style="display: flex; flex-direction: column; align-items: flex-end; gap: 8px;">
          <span class="draft-method">${getMethodDisplayName(draft.method_type)}</span>
          ${isAutoSave ? '<span class="auto-save-badge">üîÑ –ê–≤—Ç–æ–∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è</span>' : ''}
        </div>
      </div>

      <div class="draft-info">
        <div class="draft-route">${escapeHtml(draft.current_route)}</div>
        <div class="draft-dates">
          <span>–°—Ç–≤–æ—Ä–µ–Ω–æ: ${formatDate(draft.created_at)}</span>
        </div>
      </div>

      <div class="draft-actions">
        <button class="btn-continue" onclick="continueDraft(${draft.id})">
          <span>–ü—Ä–æ–¥–æ–≤–∂–∏—Ç–∏</span>
        </button>
        <button class="btn-delete" onclick="deleteDraft(${draft.id})">
          <span>–í–∏–¥–∞–ª–∏—Ç–∏</span>
        </button>
      </div>
    </div>
    `;
  }).join('');

  container.innerHTML = `
    <div class="drafts-grid">
      ${draftsHTML}
    </div>
  `;

  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã –ø–∞–≥–∏–Ω–∞—Ü–∏–∏
  document.getElementById('pagination-controls').style.display = 'block';
}

function updatePaginationInfo(pagination) {
  currentPage = pagination.page;
  currentPerPage = pagination.per_page;
  totalPages = pagination.pages;
  totalItems = pagination.total;

  // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏
  const startItem = (currentPage - 1) * currentPerPage + 1;
  const endItem = Math.min(currentPage * currentPerPage, totalItems);

  document.getElementById('pagination-text').textContent =
    `–ü–æ–∫–∞–∑–∞–Ω–æ ${startItem}-${endItem} –∑ ${totalItems} —á–µ—Ä–Ω–µ—Ç–æ–∫`;
}

function displayPagination(pagination) {
  const pageNumbersContainer = document.getElementById('page-numbers');
  const prevButton = document.getElementById('prev-page');
  const nextButton = document.getElementById('next-page');

  // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–Ω–æ–ø–æ–∫
  prevButton.disabled = !pagination.has_prev;
  nextButton.disabled = !pagination.has_next;

  // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –Ω–æ–º–µ—Ä–∞ —Å—Ç—Ä–∞–Ω–∏—Ü
  let pageNumbersHTML = '';

  if (totalPages <= 7) {
    // –ï—Å–ª–∏ —Å—Ç—Ä–∞–Ω–∏—Ü –º–∞–ª–æ, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ
    for (let i = 1; i <= totalPages; i++) {
      pageNumbersHTML += createPageNumber(i, i === currentPage);
    }
  } else {
    // –ï—Å–ª–∏ —Å—Ç—Ä–∞–Ω–∏—Ü –º–Ω–æ–≥–æ, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å –º–Ω–æ–≥–æ—Ç–æ—á–∏–µ–º
    if (currentPage <= 4) {
      // –í –Ω–∞—á–∞–ª–µ
      for (let i = 1; i <= 5; i++) {
        pageNumbersHTML += createPageNumber(i, i === currentPage);
      }
      pageNumbersHTML += createEllipsis();
      pageNumbersHTML += createPageNumber(totalPages, false);
    } else if (currentPage >= totalPages - 3) {
      // –í –∫–æ–Ω—Ü–µ
      pageNumbersHTML += createPageNumber(1, false);
      pageNumbersHTML += createEllipsis();
      for (let i = totalPages - 4; i <= totalPages; i++) {
        pageNumbersHTML += createPageNumber(i, i === currentPage);
      }
    } else {
      // –í —Å–µ—Ä–µ–¥–∏–Ω–µ
      pageNumbersHTML += createPageNumber(1, false);
      pageNumbersHTML += createEllipsis();
      for (let i = currentPage - 1; i <= currentPage + 1; i++) {
        pageNumbersHTML += createPageNumber(i, i === currentPage);
      }
      pageNumbersHTML += createEllipsis();
      pageNumbersHTML += createPageNumber(totalPages, false);
    }
  }

  pageNumbersContainer.innerHTML = pageNumbersHTML;
}

function createPageNumber(pageNum, isActive) {
  return `<span class="page-number ${isActive ? 'active' : ''}" onclick="goToPage(${pageNum})">${pageNum}</span>`;
}

function createEllipsis() {
  return `<span class="page-number ellipsis">...</span>`;
}

function goToPage(page) {
  if (page === 'prev') {
    page = currentPage - 1;
  } else if (page === 'next') {
    page = currentPage + 1;
  }

  if (page >= 1 && page <= totalPages && page !== currentPage) {
    currentPage = page;
    updateURL();
    loadDrafts();
  }
}

function changePerPage() {
  const newPerPage = parseInt(document.getElementById('per-page').value);
  if (newPerPage !== currentPerPage) {
    currentPerPage = newPerPage;
    currentPage = 1; // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –Ω–∞ –ø–µ—Ä–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
    updateURL();
    loadDrafts();
  }
}

function updateURL() {
  const url = new URL(window.location);
  url.searchParams.set('page', currentPage);
  url.searchParams.set('per_page', currentPerPage);
  window.history.pushState({}, '', url);
}

async function continueDraft(draftId) {
  try {
    const response = await fetch(`/drafts/api/${draftId}`);
    if (!response.ok) {
      throw new Error('Failed to fetch draft');
    }

    const draft = await response.json();

    // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º draft
    const url = new URL(draft.current_route, window.location.origin);
    url.searchParams.set('draft', draftId);
    window.location.href = url.toString();

  } catch (error) {
    console.error('Error continuing draft:', error);
    showError('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —á–µ—Ä–Ω–µ—Ç–∫–∏');
  }
}

async function deleteDraft(draftId) {
  if (!confirm('–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ —Ü—é —á–µ—Ä–Ω–µ—Ç–∫—É?')) {
    return;
  }

  try {
    const response = await fetch(`/drafts/api/${draftId}`, {
      method: 'DELETE'
    });

    if (!response.ok) {
      throw new Error('Failed to delete draft');
    }

    const result = await response.json();

    if (result.success) {
      // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —á–µ—Ä–Ω–æ–≤–∏–∫–∏
      loadDrafts();
    } else {
      showError('–ü–æ–º–∏–ª–∫–∞ –≤–∏–¥–∞–ª–µ–Ω–Ω—è —á–µ—Ä–Ω–µ—Ç–∫–∏');
    }

  } catch (error) {
    console.error('Error deleting draft:', error);
    showError('–ü–æ–º–∏–ª–∫–∞ –≤–∏–¥–∞–ª–µ–Ω–Ω—è —á–µ—Ä–Ω–µ—Ç–∫–∏');
  }
}

function getMethodDisplayName(methodType) {
  const methodNames = {
    'hierarchy': '–ú–µ—Ç–æ–¥ –ê–Ω–∞–ª—ñ–∑—É –Ü—î—Ä–∞—Ä—Ö—ñ–π',
    'binary': '–ú–µ—Ç–æ–¥ –ë—ñ–Ω–∞—Ä–Ω–∏—Ö –í—ñ–¥–Ω–æ—à–µ–Ω—å',
    'experts': '–ú–µ—Ç–æ–¥ –ï–∫—Å–ø–µ—Ä—Ç–Ω–∏—Ö –û—Ü—ñ–Ω–æ–∫',
    'laplasa': '–ö—Ä–∏—Ç–µ—Ä—ñ–π –õ–∞–ø–ª–∞—Å–∞',
    'maximin': '–ö—Ä–∏—Ç–µ—Ä—ñ–π –í–∞–ª—å–¥–∞',
    'savage': '–ö—Ä–∏—Ç–µ—Ä—ñ–π –°–µ–≤—ñ–¥–∂–∞',
    'hurwitz': '–ö—Ä–∏—Ç–µ—Ä—ñ–π –ì—É—Ä–≤—ñ—Ü–∞'
  };

  return methodNames[methodType] || methodType;
}

function formatDate(dateString) {
  // –ï—Å–ª–∏ –¥–∞—Ç–∞ —É–∂–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —á–∞—Å–æ–≤–æ–º –ø–æ—è—Å–µ, –∏—Å–ø–æ–ª—å–∑—É–µ–º –µ—ë –∫–∞–∫ –µ—Å—Ç—å
  let date;
  if (dateString.includes('+') || dateString.includes('Z')) {
    date = new Date(dateString);
  } else {
    // –ï—Å–ª–∏ –¥–∞—Ç–∞ –±–µ–∑ —á–∞—Å–æ–≤–æ–≥–æ –ø–æ—è—Å–∞, —Å—á–∏—Ç–∞–µ–º –µ—ë UTC –∏ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ –ö–∏–µ–≤
    date = new Date(dateString + 'Z');
  }

  return date.toLocaleDateString('uk-UA', {
    day: '2-digit',
    month: '2-digit',
    year: 'numeric',
    hour: '2-digit',
    minute: '2-digit',
    timeZone: 'Europe/Kiev'
  });
}

function escapeHtml(text) {
  const div = document.createElement('div');
  div.textContent = text;
  return div.innerHTML;
}

function showError(message) {
  const container = document.getElementById('drafts-content');
  container.innerHTML = `
    <div class="error-state">
      <div class="error-icon">‚ùå</div>
      <div class="error-text">${message}</div>
      <button onclick="loadDrafts()" class="btn-retry">–°–ø—Ä–æ–±—É–≤–∞—Ç–∏ –∑–Ω–æ–≤—É</button>
    </div>
  `;
}
</script>
{% endblock %}
